<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>浅谈js闭包  &middot; 幽幽白雪</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="description" />

<meta name="keywords" content="key, words, ">


<meta property="og:title" content="浅谈js闭包  &middot; 幽幽白雪 ">
<meta property="og:site_name" content="幽幽白雪"/>
<meta property="og:url" content="http://localhost:1313/post/html/a3/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content="description"/>
<meta property="og:article:published_time" content="2016-03-14T22:05:00&#43;08:00" />
<meta property="og:article:modified_time" content="2016-03-14T22:05:00&#43;08:00" />

  
    
<meta property="og:article:tag" content="key">
    
<meta property="og:article:tag" content="words">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="浅谈js闭包" />
<meta name="twitter:description" content="description" />
<meta name="twitter:url" content="http://localhost:1313/post/html/a3/" />
<meta name="twitter:domain" content="http://localhost:1313/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "浅谈js闭包",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2016-03-14",
    "description": "description",
    "wordCount":  569 
  }
</script>



<link rel="canonical" href="http://localhost:1313/post/html/a3/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:1313/touch-icon-144-precomposed.png">
<link href="http://localhost:1313/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.14" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="http://localhost:1313/css/bootswatch/flatly/bootstrap.min.css">


<link rel="stylesheet" href="http://localhost:1313/css/font-awesome.min.css">
<link rel="stylesheet" href="http://localhost:1313/css/style.css">


  <link rel="stylesheet" href="http://localhost:1313/css/highlight/default.css">


</head>
<body class="map[inverse:true name:flatly]">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://localhost:1313/">幽幽白雪</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>浅谈js闭包
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2016-03-14">14 Mar, 2016</time>
</small>


  <small>
    &middot; by author
  
  &middot; Read in about 3 min
  &middot; (569 Words)
</small>


<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="http://localhost:1313/tags/one" class="label label-primary">one</a>
  
  <a href="http://localhost:1313/tags/two" class="label label-primary">two</a>
  


</div>
<br>
</div>

  </div>
</div>

      <div class="content">
  <p>转自：<a href="https://segmentfault.com/a/1190000000652891">https://segmentfault.com/a/1190000000652891</a>
<div class="article fmt article__content"></p>

<p><strong>闭包</strong>（<code>closure</code>）是<code>Javascript</code>语言的一个难点，也是它的特色，很多高级应用都要依靠闭包实现。</p>
<h2 id="articleHeader0">闭包的特性</h2>
<p><strong>闭包有三个特性：</strong></p>
<pre class="hljs"><div class="widget-codetool" style="display: none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="1.函数嵌套函数
2.函数内部可以引用外部的参数和变量
3.参数和变量不会被垃圾回收机制回收" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>1.函数嵌套函数
2.函数内部可以引用外部的参数和变量
3.参数和变量不会被垃圾回收机制回收</code></pre>
<h2 id="articleHeader1">闭包的定义及其优缺点</h2>
<p><code>闭包</code> 是指有权访问另一个函数作用域中的变量的函数，创建闭包的最常见的方式就是在一个函数内创建另一个函数，通过另一个函数访问这个函数的局部变量</p>
<p>闭包的缺点就是常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</p>
<p>闭包是<code>javascript</code>语言的一大特点，主要应用闭包场合主要是为了：设计私有的方法和变量。</p>
<p>一般函数执行完毕后，局部活动对象就被销毁，内存中仅仅保存全局作用域。但闭包的情况不同！</p>
<h2 id="articleHeader2">嵌套函数的闭包</h2>
<pre class="hljs javascript"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="   function aaa() {  
          var a = 1;  
          return function(){
           alert(a++)
          };  
        }         
        var fun = aaa();  
        fun();// 1 执行后 a++，，然后a还在~  
        fun();// 2   
        fun = null;//a被回收！！ 
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">aaa</span><span class="hljs-params">()</span> </span>{  
          <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;  
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
           alert(a++)
          };  
        }         
        <span class="hljs-keyword">var</span> fun = aaa();  
        fun();<span class="hljs-comment">// 1 执行后 a++，，然后a还在~  </span>
        fun();<span class="hljs-comment">// 2   </span>
        fun = <span class="hljs-literal">null</span>;<span class="hljs-comment">//a被回收！！ </span>
</code></pre>
<p><strong>闭包</strong>会使变量始终保存在内存中，如果不当使用会增大内存消耗。</p>
<h2 id="articleHeader3">
<code>javascript</code>的垃圾回收原理</h2>
<p>（1）、在<code>javascript</code>中，如果一个对象不再被引用，那么这个对象就会被<code>GC</code>回收； <br>（2）、如果两个对象互相引用，而不再被第<code>3</code>者所引用，那么这两个互相引用的对象也会被回收。</p>
<h2 id="articleHeader4">使用闭包的好处</h2>
<p>那么使用闭包有什么好处呢？使用闭包的好处是：</p>
<pre class="hljs"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="1.希望一个变量长期驻扎在内存中
2.避免全局变量的污染
3.私有成员的存在
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>1.希望一个变量长期驻扎在内存中
2.避免全局变量的污染
3.私有成员的存在
</code></pre>
<h2 id="articleHeader5">一、全局变量的累加</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
var a = 1;
function abc(){
        a++;
        alert(a);
}
abc();              //2
abc();            //3
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">abc</span><span class="hljs-params">()</span></span>{
        a++;
        alert(a);
}
abc();              <span class="hljs-comment">//2</span>
abc();            <span class="hljs-comment">//3</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2 id="articleHeader6">二、局部变量</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>

function abc(){
        var a = 1;
        a++;
        alert(a);
}
abc();                       //2
abc();                    //2
</script>" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">abc</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
        a++;
        alert(a);
}
abc();                       <span class="hljs-comment">//2</span>
abc();                    <span class="hljs-comment">//2</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></code></pre>
<p>那么怎么才能做到变量a既是局部变量又可以累加呢？</p>
<h2 id="articleHeader7">三、局部变量的累加</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
function outer(){
        var x=10;
        return function(){             //函数嵌套函数
                x++;
                alert(x);
        }
}
var y = outer();              //外部函数赋给变量y;
y();                 //y函数调用一次，结果为11，相当于outer()()；
y();                //y函数调用第二次，结果为12，实现了累加
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">outer</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">var</span> x=<span class="hljs-number">10</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{             <span class="hljs-comment">//函数嵌套函数</span>
                x++;
                alert(x);
        }
}
<span class="hljs-keyword">var</span> y = outer();              <span class="hljs-comment">//外部函数赋给变量y;</span>
y();                 <span class="hljs-comment">//y函数调用一次，结果为11，相当于outer()()；</span>
y();                <span class="hljs-comment">//y函数调用第二次，结果为12，实现了累加</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2 id="articleHeader8">函数声明与函数表达式</h2>
<p>在js中我们可以通过关键字<code>function</code>来声明一个函数：</p>
<pre class="hljs xml"><div class="widget-codetool" style="display: none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
function abc(){
        alert(123);
}
abc();
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">abc</span><span class="hljs-params">()</span></span>{
        alert(<span class="hljs-number">123</span>);
}
abc();
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>我们也可以通过一个"()"来将这个声明变成一个表达式：</p>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
(function (){
        alert(123);
})();                   //然后通过()直接调用前面的表达式即可，因此函数可以不必写名字；
</script>" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span>{
        alert(<span class="hljs-number">123</span>);
})();                   <span class="hljs-comment">//然后通过()直接调用前面的表达式即可，因此函数可以不必写名字；</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></code></pre>
<h2 id="articleHeader9">四、模块化代码，减少全局变量的污染</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
var abc = (function(){      //abc为外部匿名函数的返回值
        var a = 1;
        return function(){
                a++;
                alert(a);
        }
})();
abc();    //2 ；调用一次abc函数，其实是调用里面内部函数的返回值    
abc();    //3
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">var</span> abc = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{      <span class="hljs-comment">//abc为外部匿名函数的返回值</span>
        <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                a++;
                alert(a);
        }
})();
abc();    <span class="hljs-comment">//2 ；调用一次abc函数，其实是调用里面内部函数的返回值    </span>
abc();    <span class="hljs-comment">//3</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2 id="articleHeader10">五、私有成员的存在</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="<script>
var aaa = (function(){
        var a = 1;
        function bbb(){
                a++;
                alert(a);
        }
        function ccc(){
                a++;
                alert(a);
        }
        return {
                b:bbb,             //json结构
                c:ccc
        }
})();
aaa.b();     //2
aaa.c()      //3
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">var</span> aaa = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bbb</span><span class="hljs-params">()</span></span>{
                a++;
                alert(a);
        }
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ccc</span><span class="hljs-params">()</span></span>{
                a++;
                alert(a);
        }
        <span class="hljs-keyword">return</span> {
                b:bbb,             <span class="hljs-comment">//json结构</span>
                c:ccc
        }
})();
aaa.b();     <span class="hljs-comment">//2</span>
aaa.c()      <span class="hljs-comment">//3</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2 id="articleHeader11">六.使用匿名函数实现累加</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="//使用匿名函数实现局部变量驻留内存中，从而实现累加

<script type=&quot;text/javascript&quot;>
 
 function box(){
     var age = 100;
     return function(){          //匿名函数
          age++;
          return age;
     };
     
 } 
var b = box();
alert(b());
alert(b());    //即alert(box()())；
alert(b());
alert(b);            //     function () {
                        //   age++;
                       // return age;
                      //       }

b = null；  //解除引用，等待垃圾回收
</script>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>//使用匿名函数实现局部变量驻留内存中，从而实现累加

<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
 
 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">box</span><span class="hljs-params">()</span></span>{
     <span class="hljs-keyword">var</span> age = <span class="hljs-number">100</span>;
     <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{          <span class="hljs-comment">//匿名函数</span>
          age++;
          <span class="hljs-keyword">return</span> age;
     };
     
 } 
<span class="hljs-keyword">var</span> b = box();
alert(b());
alert(b());    <span class="hljs-comment">//即alert(box()())；</span>
alert(b());
alert(b);            <span class="hljs-comment">//     function () {</span>
                        <span class="hljs-comment">//   age++;</span>
                       <span class="hljs-comment">// return age;</span>
                      <span class="hljs-comment">//       }</span>

b = <span class="hljs-literal">null</span>；  <span class="hljs-comment">//解除引用，等待垃圾回收</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>过度使用闭包会导致性能的下降。函数里放匿名函数，则产生了闭包</p>
<h2 id="articleHeader12">七、在循环中直接找到对应元素的索引</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="   <!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; 
&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;>
    <html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;>
    <head>
            <meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=UTF-8&quot; />
            <title></title>
    <script>
    window.onload = function(){
            var aLi = document.getElementsByTagName('li');
            for (var i=0;i<aLi.length;i++){
                    aLi[i].onclick = function(){        //当点击时for循环已经结束
                    alert(i);
                    };
            }
    }
    </script>
            
    </head>
    <body>
            <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>789</li>
                    <li>010</li>
            </ul>
    <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
    </html>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>   <span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.w3.org/1999/xhtml"</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"Content-Type"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html;charset=UTF-8"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">var</span> aLi = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'li'</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;aLi.length;i++){
                    aLi[i].onclick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{        <span class="hljs-comment">//当点击时for循环已经结束</span>
                    alert(i);
                    };
            }
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
            
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>456<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>789<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>010<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<h2 id="articleHeader13">八、使用闭包改写上面代码</h2>
<pre class="hljs xml"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="    <!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; 
&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;>

    <html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot;>
    <head>
            <meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=UTF-8&quot; />
            <title></title>
    <script>
    window.onload = function(){
            var aLi = document.getElementsByTagName('li');
            for (var i=0;i<aLi.length;i++){
                    (function(i){
                            aLi[i].onclick = function(){
                                    alert(i);
                            };
                    })(i);
            }
            };
    </script>
            
    </head>
    <body>
            <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>789</li>
            </ul>
    <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
    </html>
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code>    <span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.w3.org/1999/xhtml"</span> <span class="hljs-attribute">xml:lang</span>=<span class="hljs-value">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"Content-Type"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html;charset=UTF-8"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">var</span> aLi = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'li'</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;aLi.length;i++){
                    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i)</span></span>{
                            aLi[i].onclick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                                    alert(i);
                            };
                    })(i);
            }
            };
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
            
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>456<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>789<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<h2 id="articleHeader14">九.内存泄露问题</h2>
<p>由于<code>IE</code>的<code>js</code>对象和<code>DOM</code>对象使用不同的垃圾收集方法，因此闭包在<code>IE</code>中会导致内存泄露问题，也就是无法销毁驻留在内存中的元素</p>
<pre class="hljs javascript"><div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="function closure(){
    var oDiv = document.getElementById('oDiv');//oDiv用完之后一直驻留在内存中
    oDiv.onclick = function () {
        alert('oDiv.innerHTML');//这里用oDiv导致内存泄露
    };
}
closure();
//最后应将oDiv解除引用来避免内存泄露
function closure(){
    var oDiv = document.getElementById('oDiv');
    var test = oDiv.innerHTML;
    oDiv.onclick = function () {
        alert(test);
    };
    oDiv = null;
}
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closure</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> oDiv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'oDiv'</span>);<span class="hljs-comment">//oDiv用完之后一直驻留在内存中</span>
    oDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        alert(<span class="hljs-string">'oDiv.innerHTML'</span>);<span class="hljs-comment">//这里用oDiv导致内存泄露</span>
    };
}
closure();
<span class="hljs-comment">//最后应将oDiv解除引用来避免内存泄露</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closure</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> oDiv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'oDiv'</span>);
    <span class="hljs-keyword">var</span> test = oDiv.innerHTML;
    oDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        alert(test);
    };
    oDiv = <span class="hljs-literal">null</span>;
}
</code></pre>
<p><img data-src="/img/bVs8Ys" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" style="cursor: pointer;">  <img data-src="/img/bVs8Ym" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC" style="cursor: pointer;"></p>

<pre><code>            &lt;/div&gt;
</code></pre>

</div>


      <footer>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="http://localhost:1313/post/a2/" title="前端知识体系及资料">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>

    </div>
    
  </div>
</div>
      
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <p>
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

         </p>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  

</div>


    


          </small>
        </div>
    </div>
  </div>
</footer>

    <script src="http://localhost:1313/js/jquery.min.js"></script>
<script src="http://localhost:1313/js/bootstrap.min.js"></script>




<script src="http://localhost:1313/js/highlight.pack.js"></script>
<script src="http://localhost:1313/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



  <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

